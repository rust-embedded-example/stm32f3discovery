# HAL工程

相对于PAC工程，我们不再直接使用PAC，而是使用开源社区提供的HAL库来简化开发过程。

## PAC与HAL对比

PAC（Peripheral Access Crate）和HAL（Hardware Abstraction Layer）是两种常见的硬件交互方式，它们在抽象层次、灵活性和使用场景上有显著差异。以下是详细对比：

### 1. 定义与抽象层次

**PAC**：
- PAC是由设备寄存器直接生成的低级接口，通常由工具（如svd2rust）根据芯片的SVD（System View Description）文件自动生成
- 提供对硬件寄存器的直接访问，抽象程度低，接近裸机编程
- 主要包含寄存器级别的读写操作，开发者需要手动管理寄存器位域和硬件细节

**HAL**：
- HAL建立在PAC之上，提供更高级的硬件抽象接口
- 隐藏了寄存器级别的复杂性，提供更易用的API（如初始化外设、配置时钟、执行高级操作等）
- 通常由社区或芯片厂商为特定芯片或系列开发，注重用户友好性和跨平台兼容性

### 2. 灵活性与控制

**PAC**：
- **优点**：完全控制硬件，提供最大灵活性，适合需要极致优化或非标准用例的场景
- **缺点**：开发者需要深入理解芯片手册，处理寄存器配置、位操作等，代码复杂且易出错

**HAL**：
- **优点**：简化开发，减少手动配置硬件的负担，代码更简洁、可读性更高
- **缺点**：抽象层可能限制某些低级操作，灵活性稍低，可能不满足特殊需求

### 3. 开发效率

**PAC**：
- 开发速度慢，因为需要手动管理寄存器和硬件状态
- 适合对硬件有深入了解的开发者，或需要定制化实现的场景

**HAL**：
- 开发速度快，提供了开箱即用的功能（如UART初始化、GPIO配置等）
- 适合快速原型开发或对硬件细节不熟悉的开发者

### 4. 安全性

**PAC**：
- 依赖Rust的内存安全机制（如所有权和借用），但寄存器操作仍可能因误配置导致硬件错误
- 需要开发者确保操作的正确性

**HAL**：
- 提供更安全的接口，通过封装降低直接操作寄存器带来的风险
- 通常会包含额外的检查或默认配置，确保硬件操作更稳健

### 5. 生态与支持

**PAC**：
- 由svd2rust生成，覆盖广泛，理论上支持所有提供SVD文件的芯片
- 社区维护较少，功能仅限于寄存器访问

**HAL**：
- 依赖社区或厂商开发，某些芯片的HAL可能不完整或滞后
- 常见平台（如STM32、nRF、RP2040）有成熟的HAL实现，功能丰富，文档完善

### 6. 使用场景

**PAC**：
- 需要极致性能或完全控制硬件的场景
- 实现自定义驱动或调试硬件问题
- HAL尚未支持的芯片或外设

**HAL**：
- 快速开发嵌入式应用，缩短上市时间
- 跨平台或跨芯片的代码复用
- 标准外设（如I2C、SPI、GPIO）的常见操作